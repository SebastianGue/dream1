<html>
	<head>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
        <!-- <script src="node_modules\three\build\three.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
		<script>
               
            var scene, camera, renderer, mesh;
            var meshFloor, ambientLight, light;

            var keyboard = {};
            var player = { height:1.8, speed:0.2, turnSpeed:Math.PI*0.02 };
            var USE_WIREFRAME = false;

            // An object to hold all the things needed for our loading screen
            var loadingScreen = {
                scene: new THREE.Scene(),
                camera: new THREE.PerspectiveCamera(90, 1280/720, 0.1, 100),
                box: new THREE.Mesh(
                    new THREE.BoxGeometry(0.5,0.5,0.5),
                    new THREE.MeshBasicMaterial({ color:0x4444ff })
                )
            };
            var loadingManager = null;
            var RESOURCES_LOADED = false;

            function init(){
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(80, window.innerWidth/window.innerHeight, 0.1, 1000 );

                // Set up the loading screen's scene.
                // It can be treated just like our main scene.
                loadingScreen.box.position.set(0,0,5);
                loadingScreen.camera.lookAt(loadingScreen.box.position);
                loadingScreen.scene.add(loadingScreen.box);
                
                // Create a loading manager to set RESOURCES_LOADED when appropriate.
                // Pass loadingManager to all resource loaders.
                loadingManager = new THREE.LoadingManager();
                
                loadingManager.onProgress = function(item, loaded, total){
                    console.log(item, loaded, total);
                };
                
                loadingManager.onLoad = function(){
                    console.log("loaded all resources");
                    RESOURCES_LOADED = true;
                };
                            
                mesh = new THREE.Mesh(
                    new THREE.BoxGeometry(1,1,1),
                    new THREE.MeshPhongMaterial({color:0xff4444, wireframe:USE_WIREFRAME})
                );
                mesh.position.y += 1;
                // The cube can have shadows cast onto it, and it can cast shadows
                mesh.receiveShadow = true;
                mesh.castShadow = true;
                scene.add(mesh);
                
                meshFloor = new THREE.Mesh(
                    new THREE.PlaneGeometry(50,50, 30,10),
                    // MeshBasicMaterial does not react to lighting, so we replace with MeshPhongMaterial
                    new THREE.MeshPhongMaterial({color:0xffffff, wireframe:USE_WIREFRAME})
                    // See threejs.org/examples/ for other material types
                );
                meshFloor.rotation.x -= Math.PI / 2;
                // Floor can have shadows cast onto it
                meshFloor.receiveShadow = true;
                scene.add(meshFloor);
                
                
                // LIGHTS
                ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
                scene.add(ambientLight);
                
                light = new THREE.PointLight(0xffffff, 0.8, 18);
                light.position.set(-3,6,-3);
                light.castShadow = true;
                // Will not light anything closer than 0.1 units or further than 25 units
                light.shadow.camera.near = 0.1;
                light.shadow.camera.far = 25;
                scene.add(light);
                
                
                camera.position.set(0, player.height, -5);
                camera.lookAt(new THREE.Vector3(0,player.height,0));
                
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                
                // Enable Shadows in the Renderer
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.BasicShadowMap;
                
                document.body.appendChild(renderer.domElement);
                
                animate();
            }

            function animate(){
                requestAnimationFrame(animate);
                
                mesh.rotation.x += 0.01;
                mesh.rotation.y += 0.02;
                
                if(keyboard[87]){ // W key
                    camera.position.x -= Math.sin(camera.rotation.y) * player.speed;
                    camera.position.z -= -Math.cos(camera.rotation.y) * player.speed;
                }
                if(keyboard[83]){ // S key
                    camera.position.x += Math.sin(camera.rotation.y) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y) * player.speed;
                }
                if(keyboard[65]){ // A key
                    camera.position.x += Math.sin(camera.rotation.y + Math.PI/2) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y + Math.PI/2) * player.speed;
                }
                if(keyboard[68]){ // D key
                    camera.position.x += Math.sin(camera.rotation.y - Math.PI/2) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y - Math.PI/2) * player.speed;
                }

                if(keyboard[89]){ //Y
                    console.log(camera.aspect);
                    camera.aspect += .01
                    camera.updateProjectionMatrix()
                }

                if(keyboard[72]){ //H
                    console.log(camera.aspect);
                    camera.aspect -= .01
                    camera.updateProjectionMatrix()
                }
                
                if(keyboard[37]){ // left arrow key
                    camera.rotation.y -= player.turnSpeed;
                }
                if(keyboard[39]){ // right arrow key
                    camera.rotation.y += player.turnSpeed;
                }
                
                renderer.render(scene, camera);
            }

            function keyDown(event){
                keyboard[event.keyCode] = true;
            }

            function keyUp(event){
                keyboard[event.keyCode] = false;
            }

            window.addEventListener('keydown', keyDown);
            window.addEventListener('keyup', keyUp);

            window.onload = init;

		</script>
	</body>
</html>